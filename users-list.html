<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>All Users â€“ Full Admin Panel</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{
    margin:0;background:#0d0d0d;color:white;font-family:Arial;
}
.container{
    width:95%;max-width:850px;margin:20px auto;
}
.userBox{
    background:#111;padding:15px;margin:10px 0;
    border-radius:10px;border-left:5px solid #ff0055;
}
h2{text-align:center;margin-bottom:20px;}
.key{color:#00eaff;font-weight:bold;}
.value{color:#ddd;}
.small{font-size:14px;margin:3px 0;}

input{
    width:70px;padding:5px;border-radius:5px;border:none;
    margin-right:5px;margin-top:5px;
}
button{
    padding:5px 10px;border:none;border-radius:5px;
    background:#ff0055;color:white;cursor:pointer;
}
button:hover{
    background:#ff3377;
}
</style>

</head>
<body>

<div class="container">
    <h2>All Registered Users</h2>
    <div id="userList"></div>
</div>

<script>
// ---------------- Firebase Config -----------------
const firebaseConfig = {
  apiKey: "AIzaSyBl0PIm4lvZea96Bte3KaKQJvurGE1P8Es",
  authDomain: "post-c7e41.firebaseapp.com",
  projectId: "post-c7e41",
  databaseURL: "https://post-c7e41-default-rtdb.firebaseio.com",
  messagingSenderId: "758133068153",
  appId: "1:758133068153:web:5513a1de83491c81776084"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();


// --------------- Load All Users -----------------
function loadUsers(){
    const list = document.getElementById("userList");

    db.ref("users").on("value", snap => {
        list.innerHTML = "";

        snap.forEach(user => {
            let data = user.val();
            let uid = user.key;

            // Ensure deposit & earned exist in database
            if(data.deposit === undefined){
                db.ref("users/" + uid + "/deposit").set(0);
                data.deposit = 0;
            }
            if(data.earned === undefined){
                db.ref("users/" + uid + "/earned").set(0);
                data.earned = 0;
            }

            let details = `
                <div class="small"><span class="key">deposit:</span> <span class="value">${data.deposit}</span></div>
                <div class="small"><span class="key">earned:</span> <span class="value">${data.earned}</span></div>
                ${data.email ? `<div class="small"><span class="key">email:</span> <span class="value">${data.email}</span></div>` : ""}
                ${data.phone ? `<div class="small"><span class="key">phone:</span> <span class="value">${data.phone}</span></div>` : ""}
                <div class="small"><span class="key">uid:</span> <span class="value">${uid}</span></div>
            `;

            // Earn & Deposit Update Inputs
            details += `
                <br>

                <div>
                    <input type="number" id="earned_${uid}" placeholder="Earn">
                    <button onclick="changeBalance('${uid}', 'earned', 'add')">+ Add</button>
                    <button onclick="changeBalance('${uid}', 'earned', 'minus')">- Minus</button>
                </div>

                <div style="margin-top:10px;">
                    <input type="number" id="deposit_${uid}" placeholder="Deposit">
                    <button onclick="changeBalance('${uid}', 'deposit', 'add')">+ Add</button>
                    <button onclick="changeBalance('${uid}', 'deposit', 'minus')">- Minus</button>
                </div>
            `;

            list.innerHTML += `
                <div class="userBox">
                    <h3>User: ${data.name || "Unknown"}</h3>
                    ${details}
                </div>
            `;
        });
    });
}

loadUsers();


// ---------------- Update Earn/Deposit ----------------
function changeBalance(uid, field, action){

    let input = document.getElementById(`${field}_${uid}`);
    let amount = parseFloat(input.value);

    if(isNaN(amount) || amount <= 0){
        alert("Enter valid amount");
        return;
    }

    let ref = db.ref(`users/${uid}/${field}`);

    ref.once("value").then(snap => {
        let current = snap.val() || 0;

        let updated = (action === "add") ? current + amount : current - amount;

        if(updated < 0) updated = 0;

        ref.set(updated);

        input.value = "";
    });
}
</script>

</body>
</html>